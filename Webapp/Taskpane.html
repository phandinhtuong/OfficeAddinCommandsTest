<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <!--During development turn off caching-->
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <title></title>
    <!-- Office UI Fabric for look and feel. Visit http://dev.office.com/fabric for more info-->
    <link
      rel="stylesheet"
      href="https://appsforoffice.microsoft.com/fabric/1.0/fabric.min.css"
    />
    <link
      rel="stylesheet"
      href="https://appsforoffice.microsoft.com/fabric/1.0/fabric.components.min.css"
    />

    <!--JQuery-->
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

    <!--Office.js-->
    <script
      src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"
      type="text/javascript"
    ></script>
    <script>
      // The initialize function must be run each time a new page is loaded
      (function () {
        Office.initialize = function (reason) {
          $(document).ready(function () {
            $("#writeTextButton").click(function (event) {
              writeText();
            });
            //
          });
        };

        // Reads data from current document selection and displays a notification
        function writeText() {
          Excel.run(function (context) {
            var range = context.workbook.getSelectedRange();
            var saturation = document.getElementById("saturation").value;
            if (isNaN(saturation) || saturation == "") {
              //TODO: Display error on dialog or something
              range.values = "Saturation is NaN";
            } else if (saturation < 0 || saturation > 255) {
              //TODO: Display error on dialog or something
              range.values = "Saturation is out of range";
            } else {
              var colorSelected = document.getElementById("color").value;

              var saturationInHex = parseInt(saturation).toString(16);
              if (saturationInHex.length < 2) {
                saturationInHex = "0" + saturationInHex;
              }

              if (saturation > 128) {
                range.format.font.color = "black";
              } else {
                range.format.font.color = "white";
              }
              //range.format.fill.color = "#873F11";
              switch (colorSelected) {
                case "Red":
                  range.format.fill.color = "#" + saturationInHex + "0000";
                  range.values = "#" + saturationInHex + "0000";
                  break;
                case "Green":
                  range.format.fill.color = "#00" + saturationInHex + "00";
                  range.values = "#00" + saturationInHex + "00";
                  break;
                case "Blue":
                  range.format.fill.color = "#0000" + saturationInHex;
                  range.values = "#0000" + saturationInHex;
                  break;
                case "Gray":
                  range.format.fill.color =
                    "#" + saturationInHex + saturationInHex + saturationInHex;
                  range.values =
                    "#" + saturationInHex + saturationInHex + saturationInHex;
                  break;
              }
            }

            return context.sync();
          }).catch(function (error) {
            console.log("Error: " + error);
            if (error instanceof OfficeExtension.Error) {
              console.log("Debug info: " + JSON.stringify(error.debugInfo));
            }
          });
          // Office.context.document.setSelectedDataAsync("Data hereee",
          //     function (asyncResult) {
          //         var error = asyncResult.error;
          //         if (asyncResult.status === "failed") {
          //             //show error. Upcoming displayDialog API will help here.
          //         }
          //         else {
          //             //show success.Upcoming displayDialog API will help here.
          //         }
          //     });
        }
      })();
    </script>
  </head>
  <body>
    <button class="ms-Button" id="writeTextButton">
      <span class="ms-Button-icon"><i class="ms-Icon ms-Icon--plus"></i></span>
      <span class="ms-Button-label">Insert Text</span>
      <span class="ms-Button-description">Insert Text into Document</span>
    </button>
    <br />
    <select name="color" id="color">
      <option value="Red">Red</option>
      <option value="Green">Green</option>
      <option value="Blue">Blue</option>
      <option value="Gray">Gray</option>
    </select>
    <br />
    <label for="saturation">Saturation:</label>
    <input type="text" id="saturation" name="saturation" />
  </body>
</html>
